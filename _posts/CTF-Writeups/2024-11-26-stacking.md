---
title: "pwnable.co.il - stacking"
classes: wide
header:
  teaser: /assets/images/ctf-writeups/pwnable.co.il/logo.png
ribbon: green
description: "This challenge provides a data management service that parses your data using the CSV format."
categories:
  - CTF Writeups
  - pwn
---

> Challenge description:
>
> CSV is the best way to store data. Wanna prove me wrong?

- Note: A CSV (Comma-Separated Values) is a format of values that are typically stored in plain text, where each value is separated by a comma. Each line in a CSV file usually represents a row, and the values in each row represent fields or columns. This format is widely used for data exchange, such as exporting data from spreadsheets, databases, or for simple data storage, due to its simplicity and readability. [more info](https://en.wikipedia.org/wiki/Comma-separated_values#:~:text=Comma%2Dseparated%20values%20(CSV),typically%20represents%20one%20data%20record.)

Since the challenge is called "stacking," I assumed it would be stack-based.
To investigate further, I opened the provided ELF file in my `gef` debugger.

Here, you can see all the static function symbols provided by the ELF file:
[![static symbols](/assets/images/ctf-writeups/pwnable.co.il/stacking/symbols.png)](/assets/images/ctf-writeups/pwnable.co.il/stacking/symbols.png)


Among the functions there’s an interesting one called `win` which might be our target in this challenge,
but now let’s dig into the `main` function. 
To make it easier, I’ll use IDA decompiler to convert the code into C:

```c
int __fastcall main(int argc, const char **argv, const char **envp)
{
  void *v3; // rsi

  init_buffering(argc, argv, envp);
  puts("Welcome to my data parser!");
  puts("Please enter your comma-separated data: ");
  v3 = malloc(0x100uLL);
  read(0, v3, 0x100uLL);
  parse_data(v3);
  return 0;
}
```

Everything here looks fine, and there’s no obvious vulnerability in this code.
However, we can see another interesting function that uses in that code called `parse_data`. 
So let’s dig into it to search for vulnerabilities! 
Again, I’ll use IDA decompiler to convert the code into C:

```c
size_t __fastcall parse_data(const char *a1)
{
  size_t v1; // rbx
  size_t result; // rax
  char s[23]; // [rsp+10h] [rbp-30h] BYREF
  unsigned __int8 i; // [rsp+27h] [rbp-19h]
  int v5; // [rsp+28h] [rbp-18h]
  int v6; // [rsp+2Ch] [rbp-14h]

  v6 = -1;
  v5 = 0;
  do
  {
    memset(s, 0, 0x10uLL);
    for ( i = 0; a1[++v6] != 44; ++i )
    {
      if ( !a1[v6] )
      {
        --i;
        break;
      }
    }
    if ( (char)i > 16 )
    {
      puts("Too big data");
      exit(1);
    }
    memcpy(s, &a1[v5], i);
    v5 += i + 1;
    printf("Length: %d\n", i);
    printf("Data :%s\n", s);
    v1 = v6;
    result = strlen(a1);
  }
  while ( v1 < result );
  return result;
}
```

This function processes a CSV string, It extracts and processes each value between commas. For each value, it checks if its length exceeds 16 characters and if it does it prints an error message and exits. 
Then it stores each value in a buffer `s`, prints the length of the value and also prints the value itself. 
The function continues parsing until all values in the CSV string are processed. 
Finally, it returns the total length of the input string.
